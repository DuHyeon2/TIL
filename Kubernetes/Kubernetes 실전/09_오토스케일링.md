![Kubernetes](https://github.com/user-attachments/assets/3ec2d35d-184a-480a-878f-1f89f9547880)

# 오토스케일링
- 쿠버네티스에서 파드의 수를 자동으로 조정하는 기능
- HPA(Horizontal Pod Autoscaler)를 사용하여 구현
- 스케일 업/스케일 아웃 두개가 있다.
- 스케일 업 : 서버 스펙을 올리는것
- 스케일 아웃 : 서버 옆에 같은 스펙의 서버를 하나 더 두는것
- 보통 스케일 아웃을 한다.

## 1. HPA
- HPA는 Deployment에게 파드 갯수를 조정하라 명령하는 Object
- HPA는 CPU 사용량이나 사용자 정의 파라미터에 기반하여 파드의 수를 자동 조정

## 2. 메트릭서버
- HPA와 관련된 파드를 모니터링 하고, 그 정보를 HPA에게 전달하는 역할
- 메트릭서버는 쿠버네티스가 제공하는 YAML 파일을 통해 설치할 수 있다.
- 실질적으로 파드를 모니터링 하는 역할을 한다.

## 3. 적용 절차
- deployment 설정
    - pod에 resource 사전 제한 설정
    - pod가 생성/삭제 되는 과정에서 cpu가 튈 수 있으니 hpa와 resource limit의 cpu 여유롭게 세팅

- 메트릭 서버 설치
    ```bash
    $ kubectl apply -f https://github.com/kubernetes-sigs/metrics-server/releases/download/v0.6.3/components.yaml 
    ```

- hpa 생성 후 적용
    ```yaml
    apiVersion: autoscaling/v2
    kind: HorizontalPodAutoscaler
    metadata:
        name: hpa-name
        namespace: my-namespace
    spec:
        scaleTargetRef:
            apiVersion: apps/v1
            kind: Deployment
            name: my-deployment # autoscale 할 deployment 명을 기입해야한다.
        minReplicas: 1
        maxReplicas: 10
        metrics:
            - type: Resoucre
              resource: 
                name: cpu
                target: 
                    type: Utilization
                    averageUtilization: 50
    ```
    - deployment에 replicas 가 설정되어 있다면 제거해주자